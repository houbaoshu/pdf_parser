# GEA RAGé—®ç­”ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ðŸŽ‰ æ­å–œï¼ä½ çš„RAGç³»ç»Ÿå·²å°±ç»ª

ä½ çŽ°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„RAGï¼ˆæ£€ç´¢å¢žå¼ºç”Ÿæˆï¼‰é—®ç­”ç³»ç»Ÿï¼Œå¯ä»¥åŸºäºŽGEAè®¾å¤‡æ–‡æ¡£æ™ºèƒ½å›žç­”é—®é¢˜ã€‚

---

## ðŸ“š ç³»ç»Ÿæž¶æž„

```
ç”¨æˆ·é—®é¢˜
   â†“
[1] æœ¬åœ°Embedding (BGE-base-zh-v1.5)
   â†“
[2] Chromaå‘é‡æ£€ç´¢ (1059ä¸ªæ–‡æ¡£chunks)
   â†“
[3] OpenAI GPT-4o-miniç”Ÿæˆç­”æ¡ˆ
   â†“
ç»“æž„åŒ–ç­”æ¡ˆ + æ¥æºå¼•ç”¨
```

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: Pythonä»£ç 

```python
from gea_rag_agent_openai import GEARAGAgent

# åˆ›å»ºAgent
agent = GEARAGAgent(model="gpt-4o-mini")

# åˆå§‹åŒ–
agent.initialize()

# æé—®
answer = agent.query("GEAè®¾å¤‡çš„ç»´æŠ¤å‘¨æœŸæ˜¯å¤šä¹…ï¼Ÿ")

# æŸ¥çœ‹ç­”æ¡ˆ
print(f"ç­”æ¡ˆ: {answer.answer}")
print(f"æ¥æº: {len(answer.sources)}ä¸ªæ–‡æ¡£")
print(f"ä½¿ç”¨Tokens: {answer.tokens_used}")
```

### æ–¹å¼2: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
source .venv_debian/bin/activate

# è¿è¡Œæµ‹è¯•ï¼ˆåŒ…å«3ä¸ªç¤ºä¾‹é—®é¢˜ï¼‰
python gea_rag_agent_openai.py
```

---

## ðŸ”§ é«˜çº§ç”¨æ³•

### 1. è°ƒæ•´æ£€ç´¢æ•°é‡

```python
# æ£€ç´¢æ›´å¤šæ–‡æ¡£ï¼ˆæ›´å…¨é¢ä½†æ›´æ…¢ï¼‰
answer = agent.query("é—®é¢˜", top_k=10)

# æ£€ç´¢æ›´å°‘æ–‡æ¡£ï¼ˆæ›´å¿«ä½†å¯èƒ½ä¸å¤Ÿå…¨é¢ï¼‰
answer = agent.query("é—®é¢˜", top_k=3)
```

### 2. é™åˆ¶æ–‡æ¡£ç±»åž‹

```python
# åªæœç´¢æ–‡æœ¬
answer = agent.query("é—®é¢˜", chunk_types=["text"])

# åªæœç´¢è¡¨æ ¼
answer = agent.query("é—®é¢˜", chunk_types=["table"])

# æœç´¢æ–‡æœ¬å’Œè¡¨æ ¼
answer = agent.query("é—®é¢˜", chunk_types=["text", "table"])
```

### 3. è°ƒæ•´ç”Ÿæˆå‚æ•°

```python
# æ›´ç²¾ç¡®çš„ç­”æ¡ˆï¼ˆtemperatureä½Žï¼‰
answer = agent.query("é—®é¢˜", temperature=0.3)

# æ›´æœ‰åˆ›æ„çš„ç­”æ¡ˆï¼ˆtemperatureé«˜ï¼‰
answer = agent.query("é—®é¢˜", temperature=0.9)

# æ›´é•¿çš„ç­”æ¡ˆ
answer = agent.query("é—®é¢˜", max_tokens=2000)
```

### 4. å¤šè½®å¯¹è¯

```python
# åˆå§‹åŒ–å¯¹è¯åŽ†å²
conversation = []

# ç¬¬ä¸€è½®
answer1, conversation = agent.chat(
    "GEAè®¾å¤‡æœ‰å“ªäº›åž‹å·ï¼Ÿ",
    conversation_history=conversation
)

# ç¬¬äºŒè½®ï¼ˆåŸºäºŽä¸Šä¸‹æ–‡ï¼‰
answer2, conversation = agent.chat(
    "å®ƒä»¬çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ",
    conversation_history=conversation
)
```

---

## ðŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»æ–‡æ¡£chunks | 1059 |
| æ–‡æœ¬chunks | 647 |
| è¡¨æ ¼chunks | 224 |
| å›¾åƒchunks | 129 |
| å¹³å‡æ£€ç´¢æ—¶é—´ | ~0.13ç§’ |
| å¹³å‡ç”Ÿæˆæ—¶é—´ | ~3ç§’ |
| å¹³å‡Tokensæ¶ˆè€— | ~1000 tokens |

---

## ðŸ’° æˆæœ¬ä¼°ç®—

ä½¿ç”¨ **gpt-4o-mini**:
- è¾“å…¥: $0.150 / 1M tokens
- è¾“å‡º: $0.600 / 1M tokens
- å¹³å‡æ¯æ¬¡æŸ¥è¯¢: ~$0.001 (çº¦Â¥0.007)

**æ¯å¤©100æ¬¡æŸ¥è¯¢ â‰ˆ $0.10 (çº¦Â¥0.70)**

---

## ðŸŽ¯ æœ€ä½³å®žè·µ

### 1. æé—®æŠ€å·§

âœ… **å¥½çš„é—®é¢˜**:
- "TPS 2030åž‹å·çš„è½¬é€Ÿæ˜¯å¤šå°‘ï¼Ÿ"
- "å¦‚ä½•æ›´æ¢æœºæ¢°å¯†å°ï¼Ÿ"
- "è®¾å¤‡ç»´æŠ¤éœ€è¦æ³¨æ„å“ªäº›å®‰å…¨äº‹é¡¹ï¼Ÿ"

âŒ **ä¸å¥½çš„é—®é¢˜**:
- "è®¾å¤‡æ€Žä¹ˆæ ·ï¼Ÿ"ï¼ˆå¤ªæ¨¡ç³Šï¼‰
- "æ‰€æœ‰å‚æ•°"ï¼ˆå¤ªå®½æ³›ï¼‰
- "ä»·æ ¼å¤šå°‘ï¼Ÿ"ï¼ˆæ–‡æ¡£ä¸­æ²¡æœ‰ï¼‰

### 2. æ£€ç´¢ä¼˜åŒ–

- **å…·ä½“é—®é¢˜**: ä½¿ç”¨ top_k=3-5
- **ç»¼åˆé—®é¢˜**: ä½¿ç”¨ top_k=5-10
- **è¡¨æ ¼æŸ¥è¯¢**: æŒ‡å®š chunk_types=["table"]
- **æ“ä½œæŒ‡å—**: æŒ‡å®š chunk_types=["text"]

### 3. Tokenä¼˜åŒ–

- å‡å°‘ top_k é™ä½Žè¾“å…¥token
- å‡å°‘ max_tokens é™ä½Žè¾“å‡ºtoken
- ç¼“å­˜å¸¸è§é—®é¢˜çš„ç­”æ¡ˆ

---

## ðŸ” ç­”æ¡ˆè´¨é‡è¯„ä¼°

æ¯ä¸ªç­”æ¡ˆåŒ…å«ï¼š

```python
RAGAnswer {
    question: str          # åŽŸå§‹é—®é¢˜
    answer: str           # ç”Ÿæˆçš„ç­”æ¡ˆ
    sources: List[Dict]   # æ¥æºæ–‡æ¡£åˆ—è¡¨
    search_results: List  # è¯¦ç»†æ£€ç´¢ç»“æžœ
    model: str            # ä½¿ç”¨çš„æ¨¡åž‹
    tokens_used: int      # æ¶ˆè€—çš„tokens
    has_answer: bool      # æ˜¯å¦æ‰¾åˆ°ç­”æ¡ˆ
}
```

**è¯„ä¼°æŒ‡æ ‡**:
- **ç›¸ä¼¼åº¦ > 0.6**: é«˜ç›¸å…³æ€§
- **ç›¸ä¼¼åº¦ 0.4-0.6**: ä¸­ç­‰ç›¸å…³æ€§
- **ç›¸ä¼¼åº¦ < 0.4**: ä½Žç›¸å…³æ€§ï¼ˆå¯èƒ½ç­”æ¡ˆä¸å‡†ç¡®ï¼‰

---

## ðŸ› ï¸ æ•…éšœæŽ’é™¤

### é—®é¢˜1: OpenAI APIé”™è¯¯

```bash
# æ£€æŸ¥APIå¯†é’¥
echo $OPENAI_API_KEY

# è®¾ç½®APIå¯†é’¥
export OPENAI_API_KEY="your-api-key"
```

### é—®é¢˜2: æ‰¾ä¸åˆ°ç›¸å…³æ–‡æ¡£

å¯èƒ½åŽŸå› ï¼š
- é—®é¢˜ä¸Žæ–‡æ¡£å†…å®¹ä¸åŒ¹é…
- é—®é¢˜å¤ªæ¨¡ç³Š

è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯
- å¢žåŠ  top_k å€¼
- å°è¯•ä¸åŒçš„è¡¨è¾¾æ–¹å¼

### é—®é¢˜3: ç­”æ¡ˆä¸å‡†ç¡®

å¯èƒ½åŽŸå› ï¼š
- æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸ç›¸å…³
- æ–‡æ¡£å†…å®¹ä¸è¶³

è§£å†³æ–¹æ¡ˆï¼š
- æ£€æŸ¥ sources ä¸­çš„ç›¸ä¼¼åº¦åˆ†æ•°
- å¢žåŠ  top_k èŽ·å–æ›´å¤šä¸Šä¸‹æ–‡
- é™ä½Ž temperature æé«˜ç²¾ç¡®åº¦

### é—®é¢˜4: å“åº”å¤ªæ…¢

ä¼˜åŒ–æ–¹æ¡ˆï¼š
- å‡å°‘ top_k
- å‡å°‘ max_tokens
- ä½¿ç”¨æ›´å¿«çš„æ¨¡åž‹ï¼ˆgpt-3.5-turboï¼‰
- ç¼“å­˜å¸¸è§é—®é¢˜

---

## ðŸ“ˆ ä¸‹ä¸€æ­¥ä¼˜åŒ–

1. **æ·»åŠ Re-ranking**: ä½¿ç”¨BGE-rerankeræå‡æ£€ç´¢å‡†ç¡®çŽ‡
2. **æ··åˆæ£€ç´¢**: ç»“åˆBM25å…³é”®è¯æœç´¢
3. **Queryé‡å†™**: è‡ªåŠ¨æ”¹å†™æ¨¡ç³Šé—®é¢˜
4. **ç­”æ¡ˆç¼“å­˜**: ç¼“å­˜å¸¸è§é—®é¢˜ç­”æ¡ˆ
5. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†åé¦ˆæŒç»­ä¼˜åŒ–
6. **Webç•Œé¢**: ä½¿ç”¨Streamlit/Gradioæž„å»ºUI

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

- æŸ¥çœ‹ç¤ºä¾‹: `python gea_rag_agent_openai.py`
- æŸ¥çœ‹æºç : `gea_rag_agent_openai.py`
- Chromaæ–‡æ¡£: https://docs.trychroma.com/
- OpenAIæ–‡æ¡£: https://platform.openai.com/docs

---

## ðŸŽŠ æ€»ç»“

ä½ çŽ°åœ¨æ‹¥æœ‰ï¼š
- âœ… é«˜æ€§èƒ½å‘é‡æ£€ç´¢ï¼ˆChromaï¼‰
- âœ… æœ¬åœ°Embeddingï¼ˆæ— éœ€å¤–éƒ¨APIï¼‰
- âœ… æ™ºèƒ½ç­”æ¡ˆç”Ÿæˆï¼ˆOpenAIï¼‰
- âœ… å®Œæ•´çš„æ¥æºè¿½æº¯
- âœ… çµæ´»çš„é…ç½®é€‰é¡¹

**å¼€å§‹æé—®å§ï¼** ðŸš€
